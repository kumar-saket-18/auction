{% extends 'base/base.html' %}

{% block content %}
<div class="row">
    <!-- Players List -->
    <div class="col-xl-12">
        <div class="card">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <!-- Title -->
                    <h4 class="box-title">Players List</h4>
                    <!-- Player Counter -->
                    <span id="player-counter" style="font-weight: bold; color: #007bff;">
                        Total Players Left: {{ players|length }}
                    </span>
                </div>
            </div>
            <div class="card-body--">
                <div class="table-stats order-table ov-h">
                    <table class="table">
                        <thead>
                            <tr>
                                <th class="serial">Player ID</th>
                                <th>Name</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if players %}
                                {% for player in players %}
                                    <tr>
                                        <td class="serial">{{ player.player_id }}</td>
                                        <td>{{ player.name }}</td>
                                    </tr>
                                {% endfor %}
                            {% else %}
                                <tr><td colspan="2">No Player Data</td></tr>
                            {% endif %}
                        </tbody>
                    </table>

                    <!-- Coin flipping animation button -->
                    <div class="text-center mt-3">
                        <button id="random-btn" class="btn btn-primary" style="border-radius: 50%; width: 80px; height: 80px; padding: 0; background-color: #f1c40f; border: 2px solid #d4ac0d;">
                            <i id="coin-icon" class="fas fa-coins" style="font-size: 2.5rem; color: #fff;"></i> <!-- Font Awesome coin icon -->
                        </button>
                    </div>
                    

                    <!-- Random player result -->
                    <div id="random-player" class="text-center mt-3" style="font-weight: bold; color: #d32f2f;">
                        <!-- Random player result will appear here -->
                    </div>
                </div>
            </div>
        </div> <!-- /.card -->
    </div>  <!-- /.col-lg-12 -->
</div>

<!-- CSS for coin flip animation -->
<style>
    /* Coin icon flip animation */
    @keyframes flipCoin {
        0% { transform: rotateY(0deg); }
        50% { transform: rotateY(180deg); }
        100% { transform: rotateY(360deg); }
    }

    /* Coin flipping class to animate the icon, not the button */
    #coin-icon.coin-flipping {
        animation: flipCoin 1.5s ease-in-out;
    }
</style>

<script>
    // Get players from Django template context
    const players = [
        {% for player in players %}
            { id: {{ player.player_id }}, name: "{{ player.name }}" },
        {% endfor %}
    ];

    // Function to generate a random player
    function generateRandomPlayer() {
        if (players.length === 0) {
            document.getElementById('random-player').textContent = 'No players left to select!';
            return;
        }

        // Add coin flipping animation to the icon only
        const coinIcon = document.getElementById('coin-icon');
        coinIcon.classList.add('coin-flipping');

        // Disable the button during animation
        const button = document.getElementById('random-btn');
        button.disabled = true;

        // Wait for animation to finish before selecting a player
        setTimeout(() => {
            const randomIndex = Math.floor(Math.random() * players.length);
            const randomPlayer = players[randomIndex];

            document.getElementById('random-player').textContent = `Player Name: ${randomPlayer.name}, Player Id: ${randomPlayer.id}`;

            // Remove the selected player from the list
            players.splice(randomIndex, 1);
            updatePlayerList();
            updatePlayerCounter(); // Update the player counter after selection

            // Remove coin flipping animation
            coinIcon.classList.remove('coin-flipping');
            button.disabled = false; // Enable the button again

        }, 1500); // The delay matches the coin flipping animation duration
    }

    // Function to update the player list
    function updatePlayerList() {
        const tableBody = document.querySelector('.table tbody');
        tableBody.innerHTML = '';  // Clear existing content

        players.forEach(player => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td class="serial">${player.id}</td>
                <td>${player.name}</td>
            `;
            tableBody.appendChild(row);
        });
    }

    // Function to update the player counter
    function updatePlayerCounter() {
        const counterElement = document.getElementById('player-counter');
        counterElement.textContent = `Total Players Left: ${players.length}`;
    }

    // Add event listener to the "Generate Random Player" button
    document.getElementById('random-btn').addEventListener('click', generateRandomPlayer);

    // Initial render of players and counter
    updatePlayerList();
    updatePlayerCounter();
</script>

{% endblock content %}
